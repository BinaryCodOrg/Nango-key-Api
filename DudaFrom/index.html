<form id="integrationForm">
  <label for="toolName">Select Tool:</label>
  <select id="toolName" name="toolName" required>
    <option value="">Loading tools...</option>
  </select>

  <label for="clientId">Client ID:</label>
  <input type="text" id="clientId" name="clientId" required />

  <label for="clientName">Client Name:</label>
  <input type="text" id="clientName" name="clientName" required />

  <button type="submit">Submit</button>
</form>

<script>
  // ✅ Load Nango tools from your proxy API
  async function loadTools() {
    try {
      const res = await fetch(
        "https://nango-tools-getter.netlify.app/.netlify/functions/nango"
      );
      const tools = await res.json();

      const toolSelect = document.getElementById("toolName");
      toolSelect.innerHTML = ""; // clear loading option

      tools.forEach((tool) => {
        const option = document.createElement("option");
        option.value = tool.display_name || tool.name;
        option.textContent = tool.display_name || tool.name;
        toolSelect.appendChild(option);
      });
    } catch (error) {
      console.error("Error loading tools:", error);
    }
  }

  loadTools();

  // ✅ Handle form submission → send to Airtable proxy
  document
    .getElementById("integrationForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const payload = {
        toolName: document.getElementById("toolName").value,
        clientId: document.getElementById("clientId").value,
        clientName: document.getElementById("clientName").value,
      };

      try {
        const res = await fetch(
          "https://nango-tools-getter.netlify.app/.netlify/functions/airtable",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          }
        );

        if (res.ok) {
          alert("Form submitted successfully!");
          document.getElementById("integrationForm").reset();
        } else {
          const errorMsg = await res.text();
          alert("Error submitting form: " + errorMsg);
        }
      } catch (error) {
        console.error("Error:", error);
        alert("Unexpected error. Check console for details.");
      }
    });
</script>
